import{_ as f,k as b,o as i,c as l,d as t,g as v,B as w,C as B,x as c,p as A,h as C,D as I,w as S,e as T,v as D,F as m,b as g,S as x,N as j,E as N,G as p,H as P,z as R,A as z}from"./index-e8246874.js";import{P as k,D as F}from"./jquery.dataTables-00a8a59a.js";const d=s=>(R("data-v-908d17da"),s=s(),z(),s),M={id:"wrapper"},U={id:"content-wrapper",class:"d-flex flex-column"},E={id:"content"},L=d(()=>t("h1",{class:"h3 mb-0 text-gray-800 text-center"},"Pembayaran",-1)),V={class:"row"},J=d(()=>t("div",{class:"col-1"},null,-1)),O={class:"col-10"},H={class:"row mt-5"},K=d(()=>t("div",{class:"col-sm-9"},null,-1)),W={class:"col-sm-3"},q={class:"dropdown"},G=d(()=>t("button",{class:"btn btn-secondary dropdown-toggle",type:"button",id:"dropdownMenuButton","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"}," Filter ",-1)),Q={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton"},X={class:"table-responsive"},Y={key:0,class:"preloader"},Z=d(()=>t("thead",null,[t("tr",null,[t("th",{scope:"col"},"No"),t("th",{scope:"col"},"Nama"),t("th",{scope:"col"},"No. HP"),t("th",{scope:"col"},"No. Rekening"),t("th",{scope:"col"},"Jumlah Transfer"),t("th",{scope:"col"},"Bukti Transfer"),t("th",{scope:"col"},"Status"),t("th",{scope:"col"},"Aksi")])],-1)),tt={scope:"row"},et=["src","onClick"],at={key:0,class:"bg-warning text-white rounded text-center"},st={key:1,class:"bg-success text-white rounded text-center"},ot={key:2,class:"bg-danger rounded text-center"},nt={key:3,class:"bg-secondary text-white rounded text-center"},it={key:4,class:"bg-primary text-white rounded text-center"},rt=["onClick"],lt=["onClick"],dt=["onClick"],ct=d(()=>t("div",{class:"col-1"},null,-1)),ut={class:"modal fade",id:"aturTanggal",tabindex:"-1",role:"dialog","aria-labelledby":"aturTanggalLabel","aria-hidden":"true",ref:"aturTanggalRef"},ht={class:"modal-dialog",role:"document"},pt={class:"modal-content"},gt=d(()=>t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"addInvoiceModalLabel"},"Atur Tanggal"),t("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[t("span",{"aria-hidden":"true"},"×")])],-1)),_t={class:"modal-body"},vt={class:"form-group"},bt=d(()=>t("label",{for:"tanggal"},"Tanggal Berakhir",-1)),mt=d(()=>t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"}," Close "),t("button",{type:"submit",class:"btn btn-primary"},"Simpan")],-1)),kt={class:"modal fade",id:"detailBukti",tabindex:"-1",role:"dialog","aria-labelledby":"detailBuktiLabel","aria-hidden":"true",ref:"detailBuktiRef"},yt={class:"modal-dialog",role:"document"},ft={class:"modal-content"},wt=d(()=>t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"addInvoiceModalLabel"}," Detail Bukti Transfer "),t("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[t("span",{"aria-hidden":"true"},"×")])],-1)),Bt={class:"modal-body"},At=["src"],Ct=d(()=>t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"}," Close ")],-1));k.use(F);const It={data(){return{invoices:[],ready:null,user_id:null,path:null,dataAction:{user_id:"",invoice_id:"",status_invoice:"",tanggal_berakhir:""}}},methods:{setDataAction(s,o,r){this.dataAction.user_id=s,this.dataAction.invoice_id=o,this.dataAction.status_invoice=r},async getAllDataInvoice(){try{const s=await g.get("https://backend-webmember.lumirainternational.com/api/auth/list-invoice",{headers:{Authorization:"Bearer "+sessionStorage.getItem("token")}});this.invoices=s.data.data,this.ready=!0,console.log("ini invoice",this.invoices)}catch(s){console.error(s)}},async getInvoiceByStatus(s){try{this.ready=!1;const o=await g.get(`https://backend-webmember.lumirainternational.com/api/auth/invoice-status/${s}`,{headers:{Authorization:"Bearer "+sessionStorage.getItem("token")}});this.invoices=o.data.data,this.ready=!0,console.log("ini invoice",this.invoices)}catch(o){console.error(o)}},detailBukti(s){this.path=s,$("#detailBukti").modal("show")},async aturTanggal(){try{const s=new FormData;s.append("user_id",this.user_id),s.append("invoice_id",this.selectedInvoice),s.append("tanggal_berakhir",this.date);const o=await g.post("https://backend-webmember.lumirainternational.com/api/auth/atur-tanggal",s,{headers:{Authorization:"Bearer "+sessionStorage.getItem("token")}});this.ready=!1,this.showAlert(),this.getAllDataInvoice(),console.log("ini invoice",this.invoices)}catch(s){console.error(s)}},async actionInvoice(s,o,r,u=null){try{let a=new FormData;a.append("user_id",s),a.append("invoice_id",o),a.append("status_invoice",r),u!=null&&a.append("tanggal_berakhir",u);const n=await g.post("https://backend-webmember.lumirainternational.com/api/auth/action-invoice",a,{headers:{Authorization:"Bearer "+sessionStorage.getItem("token")}});console.log("Invoice berhasil ditolak:",n.data),this.showAlert(),this.ready=!1,this.getAllDataInvoice()}catch(a){console.error("Terjadi kesalahan:",a)}},showAlert(){this.$swal({title:"Request Success",text:"Data Berhasil Dikirim!",icon:"success"}).then(()=>{$("#aturTanggal").modal("hide")})},konfirmasi(s,o,r,u){x.fire({title:`Apakah Anda yakin ingin mereject invoice ${u}?`,text:"Anda akan keluar dari akun ini.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#061387",confirmButtonText:"Reject",cancelButtonText:"Batal"}).then(a=>{a.isConfirmed&&this.actionInvoice(s,o,r)})}},created(){const s=new Date().toUTCString();console.log("Waktu Sekarang (UTC):",s);const o=sessionStorage.getItem("token");if(o)try{const[r,u]=o.split("."),a=JSON.parse(atob(r)),n=atob(u),e=JSON.parse(atob(o.split(".")[1])),_=e.exp,h=new Date(_*1e3);console.log("Waktu Kedaluwarsa (UTC):",h.toUTCString()),new Date>h?(console.log("Keluar"),sessionStorage.removeItem("token"),this.$router.push("/")):console.log("Aman");const y=e.level;this.user_id=e.id,y!=="1"?this.$router.push("/unauthorized"):(!a||!n)&&(this.$router.push("/"),sessionStorage.removeItem("token")),this.getAllDataInvoice()}catch(r){console.error("Error decoding token:",r),this.$router.push("/")}else this.$router.push("/")}},St=Object.assign(It,{__name:"Invoices",setup(s){const o=b(!1),r=b(""),u=()=>{o.value=!o.value,r.value=o.value?"toggle-sidebar":""};return(a,n)=>(i(),l(m,null,[t("div",M,[v(B,{class:w(r.value)},null,8,["class"]),t("div",U,[t("div",E,[v(j,{onToggleSidebar:u}),L,t("div",V,[J,t("div",O,[t("div",H,[K,t("div",W,[t("div",q,[G,t("div",Q,[t("a",{class:"dropdown-item",href:"#",onClick:n[0]||(n[0]=e=>a.getInvoiceByStatus("0"))},"Pending"),t("a",{class:"dropdown-item",href:"#",onClick:n[1]||(n[1]=e=>a.getInvoiceByStatus("1"))},"Active"),t("a",{class:"dropdown-item",href:"#",onClick:n[2]||(n[2]=e=>a.getInvoiceByStatus("3"))},"Expired"),t("a",{class:"dropdown-item",href:"#",onClick:n[3]||(n[3]=e=>a.getInvoiceByStatus("2"))},"Reject"),t("a",{class:"dropdown-item",href:"#",onClick:n[4]||(n[4]=e=>a.getInvoiceByStatus("00"))},"Perpanjang")])])])]),t("div",X,[a.ready?c("",!0):(i(),l("div",Y)),a.ready?(i(),A(I(k),{key:1,class:"display table table-striped"},{default:C(()=>[Z,t("tbody",null,[(i(!0),l(m,null,N(a.invoices,(e,_)=>(i(),l("tr",{key:e.id},[t("th",tt,p(_+1),1),t("td",null,p(e.user.name),1),t("td",null,p(e.user.no_hp),1),t("td",null,p(e.nomor_rekening),1),t("td",null,p(e.jumlah_transfer),1),t("td",null,[t("img",{src:"https://backend-webmember.lumirainternational.com/storage/"+e.bukti_transfer,alt:"Bukti Transfer",style:{"max-width":"100px",cursor:"pointer"},onClick:h=>a.detailBukti(e.bukti_transfer)},null,8,et)]),t("td",null,[e.status=="0"?(i(),l("div",at," Pending ")):c("",!0),e.status=="1"?(i(),l("div",st," Active ")):c("",!0),e.status=="2"?(i(),l("div",ot," Reject ")):c("",!0),e.status=="3"?(i(),l("div",nt," Expired ")):c("",!0),e.status=="00"?(i(),l("div",it," Perpanjang ")):c("",!0)]),t("td",null,[e.status=="1"||e.status=="0"?(i(),l("button",{key:0,class:"btn btn-danger me-1",onClick:h=>a.konfirmasi(e.user_id,e.id,"2",e.user.name)}," Reject ",8,rt)):c("",!0),e.status=="0"||e.status=="00"?(i(),l("button",{key:1,class:"btn btn-success",onClick:h=>a.setDataAction(e.user_id,e.id,"1"),"data-toggle":"modal","data-target":"#aturTanggal"}," Accept ",8,lt)):c("",!0),e.status=="3"?(i(),l("button",{key:2,class:"btn btn-success",onClick:h=>a.setDataAction(e.user_id,e.id,"3"),"data-toggle":"modal","data-target":"#aturTanggal"}," Perpanjang ",8,dt)):c("",!0)])]))),128))])]),_:1})):c("",!0)])]),ct])]),v(P)])]),t("div",ut,[t("div",ht,[t("div",pt,[gt,t("div",_t,[t("form",{onSubmit:n[6]||(n[6]=S(e=>a.actionInvoice(a.dataAction.user_id,a.dataAction.invoice_id,a.dataAction.status_invoice,a.dataAction.tanggal_berakhir),["prevent"]))},[t("div",vt,[bt,T(t("input",{type:"date",class:"form-control",id:"tanggal","onUpdate:modelValue":n[5]||(n[5]=e=>a.dataAction.tanggal_berakhir=e)},null,512),[[D,a.dataAction.tanggal_berakhir]])]),mt],32)])])])],512),t("div",kt,[t("div",yt,[t("div",ft,[wt,t("div",Bt,[t("img",{src:"https://backend-webmember.lumirainternational.com/storage/"+a.path,alt:"Bukti Transfer",style:{width:"100%"}},null,8,At),Ct])])])],512)],64))}}),$t=f(St,[["__scopeId","data-v-908d17da"]]);export{$t as default};
