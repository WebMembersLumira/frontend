import{_ as y,j as b,o as r,c as d,d as e,f as v,A as w,B,t as h,n as A,g as I,C as S,w as T,e as C,v as D,F as m,b as p,S as N,N as x,D as j,E as u,G as R,y as z,z as P}from"./index-b55ee009.js";import{P as k,D as F}from"./jquery.dataTables-cbe4a304.js";const l=s=>(z("data-v-2ef38b05"),s=s(),P(),s),L={id:"wrapper"},M={id:"content-wrapper",class:"d-flex flex-column"},U={id:"content"},J=l(()=>e("h1",{class:"h3 mb-0 text-gray-800 text-center"},"Pembayaran",-1)),V={class:"row"},E=l(()=>e("div",{class:"col-1"},null,-1)),O={class:"col-10"},K={class:"row mt-5"},W=l(()=>e("div",{class:"col-sm-9"},null,-1)),q={class:"col-sm-3"},G={class:"dropdown"},H=l(()=>e("button",{class:"btn btn-secondary dropdown-toggle",type:"button",id:"dropdownMenuButton","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"}," Filter ",-1)),Q={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton"},X={class:"table-responsive"},Y={key:0,class:"preloader"},Z=l(()=>e("thead",null,[e("tr",null,[e("th",{scope:"col"},"No"),e("th",{scope:"col"},"Nama"),e("th",{scope:"col"},"No. HP"),e("th",{scope:"col"},"Nama Pengirim"),e("th",{scope:"col"},"No. Rekening"),e("th",{scope:"col"},"Jenis Langganan"),e("th",{scope:"col"},"Jumlah Transfer"),e("th",{scope:"col"},"Bukti Transfer"),e("th",{scope:"col"},"Tanggal Berakhir"),e("th",{scope:"col"},"Status"),e("th",{scope:"col"},"Aksi")])],-1)),ee={scope:"row"},te=["src","onClick"],ae={key:0,class:"bg-warning text-white rounded text-center"},se={key:1,class:"bg-success text-white rounded text-center"},oe={key:2,class:"bg-danger rounded text-center"},ne=["onClick"],ie=["onClick"],le=l(()=>e("div",{class:"col-1"},null,-1)),re={class:"modal fade",id:"aturTanggal",tabindex:"-1",role:"dialog","aria-labelledby":"aturTanggalLabel","aria-hidden":"true",ref:"aturTanggalRef"},de={class:"modal-dialog",role:"document"},ce={class:"modal-content"},ue=l(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"addInvoiceModalLabel"},"Atur Tanggal"),e("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[e("span",{"aria-hidden":"true"},"×")])],-1)),he={class:"modal-body"},ge={class:"form-group"},pe=l(()=>e("label",{for:"tanggal"},"Tanggal Berakhir",-1)),_e=l(()=>e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"}," Close "),e("button",{type:"submit",class:"btn btn-primary"},"Simpan")],-1)),ve={class:"modal fade",id:"detailBukti",tabindex:"-1",role:"dialog","aria-labelledby":"detailBuktiLabel","aria-hidden":"true",ref:"detailBuktiRef"},be={class:"modal-dialog",role:"document"},me={class:"modal-content"},ke=l(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"addInvoiceModalLabel"}," Detail Bukti Transfer "),e("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[e("span",{"aria-hidden":"true"},"×")])],-1)),fe={class:"modal-body"},ye=["src"],we=l(()=>e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"}," Close ")],-1));k.use(F);const Be={data(){return{invoices:[],ready:null,user_id:null,path:null,dataAction:{user_id:"",invoice_id:"",status_invoice:"",tanggal_berakhir:""}}},methods:{setDataAction(s,o,i){this.dataAction.user_id=s,this.dataAction.invoice_id=o,this.dataAction.status_invoice=i},async getAllDataInvoice(){try{const s=await p.get("https://backend-webmember.lumirainternational.com/api/auth/list-invoice",{headers:{Authorization:"Bearer "+sessionStorage.getItem("token")}});this.invoices=s.data.data,this.ready=!0,console.log("ini invoice",this.invoices)}catch(s){console.error(s)}},async getInvoiceByStatus(s){try{this.ready=!1;const o=await p.get(`https://backend-webmember.lumirainternational.com/api/auth/invoice-status/${s}`,{headers:{Authorization:"Bearer "+sessionStorage.getItem("token")}});this.invoices=o.data.data,this.ready=!0,console.log("ini invoice",this.invoices)}catch(o){console.error(o)}},detailBukti(s){this.path=s,$("#detailBukti").modal("show")},async aturTanggal(){try{const s=new FormData;s.append("user_id",this.user_id),s.append("invoice_id",this.selectedInvoice),s.append("tanggal_berakhir",this.date);const o=await p.post("https://backend-webmember.lumirainternational.com/api/auth/atur-tanggal",s,{headers:{Authorization:"Bearer "+sessionStorage.getItem("token")}});this.ready=!1,this.showAlert(),this.getAllDataInvoice(),console.log("ini invoice",this.invoices)}catch(s){console.error(s)}},async actionInvoice(s,o,i,c=null){try{let a=new FormData;a.append("user_id",s),a.append("invoice_id",o),a.append("status_invoice",i),c!=null&&a.append("tanggal_berakhir",c);const n=await p.post("https://backend-webmember.lumirainternational.com/api/auth/action-invoice",a,{headers:{Authorization:"Bearer "+sessionStorage.getItem("token")}});console.log("Invoice berhasil ditolak:",n.data),this.showAlert(),this.ready=!1,this.getAllDataInvoice()}catch(a){console.error("Terjadi kesalahan:",a)}},showAlert(){this.$swal({title:"Request Success",text:"Data Berhasil Dikirim!",icon:"success"}).then(()=>{$("#aturTanggal").modal("hide")})},konfirmasi(s,o,i,c){N.fire({title:`Apakah Anda yakin ingin mereject invoice ${c}?`,text:"Anda akan keluar dari akun ini.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#061387",confirmButtonText:"Reject",cancelButtonText:"Batal"}).then(a=>{a.isConfirmed&&this.actionInvoice(s,o,i)})}},created(){const s=new Date().toUTCString();console.log("Waktu Sekarang (UTC):",s);const o=sessionStorage.getItem("token");if(o)try{const[i,c]=o.split("."),a=JSON.parse(atob(i)),n=atob(c),t=JSON.parse(atob(o.split(".")[1])),_=t.exp,g=new Date(_*1e3);console.log("Waktu Kedaluwarsa (UTC):",g.toUTCString()),new Date>g?(console.log("Keluar"),sessionStorage.removeItem("token"),this.$router.push("/")):console.log("Aman");const f=t.level;this.user_id=t.id,f!=="1"?this.$router.push("/unauthorized"):(!a||!n)&&(this.$router.push("/"),sessionStorage.removeItem("token")),this.getAllDataInvoice()}catch(i){console.error("Error decoding token:",i),this.$router.push("/")}else this.$router.push("/")}},Ae=Object.assign(Be,{__name:"Invoices",setup(s){const o=b(!1),i=b(""),c=()=>{o.value=!o.value,i.value=o.value?"toggle-sidebar":""};return(a,n)=>(r(),d(m,null,[e("div",L,[v(B,{class:w(i.value)},null,8,["class"]),e("div",M,[e("div",U,[v(x,{onToggleSidebar:c}),J,e("div",V,[E,e("div",O,[e("div",K,[W,e("div",q,[e("div",G,[H,e("div",Q,[e("a",{class:"dropdown-item",href:"#",onClick:n[0]||(n[0]=t=>a.getInvoiceByStatus("0"))},"Pending"),e("a",{class:"dropdown-item",href:"#",onClick:n[1]||(n[1]=t=>a.getInvoiceByStatus("1"))},"Active"),e("a",{class:"dropdown-item",href:"#",onClick:n[2]||(n[2]=t=>a.getInvoiceByStatus("2"))},"Reject")])])])]),e("div",X,[a.ready?h("",!0):(r(),d("div",Y)),a.ready?(r(),A(S(k),{key:1,class:"display table table-striped"},{default:I(()=>[Z,e("tbody",null,[(r(!0),d(m,null,j(a.invoices,(t,_)=>(r(),d("tr",{key:t.id},[e("th",ee,u(_+1),1),e("td",null,u(t.user.name),1),e("td",null,u(t.user.no_hp),1),e("td",null,u(t.nama_pengirim),1),e("td",null,u(t.nomor_rekening),1),e("td",null,u(t.langganan.jenis_langganan),1),e("td",null,u(t.jumlah_transfer),1),e("td",null,[e("img",{src:"https://backend-webmember.lumirainternational.com/storage/"+t.bukti_transfer,alt:"Bukti Transfer",style:{"max-width":"100px",cursor:"pointer"},onClick:g=>a.detailBukti(t.bukti_transfer)},null,8,te)]),e("td",null,u(t.tanggal_berakhir!=null?t.tanggal_berakhir:"Belum Diatur"),1),e("td",null,[t.status=="0"?(r(),d("div",ae," Pending ")):h("",!0),t.status=="1"?(r(),d("div",se," Active ")):h("",!0),t.status=="2"?(r(),d("div",oe," Reject ")):h("",!0)]),e("td",null,[t.status=="1"||t.status=="0"?(r(),d("button",{key:0,class:"btn btn-danger me-1",onClick:g=>a.konfirmasi(t.user_id,t.id,"2",t.user.name)}," Reject ",8,ne)):h("",!0),t.status=="0"||t.status=="00"?(r(),d("button",{key:1,class:"btn btn-success",onClick:g=>a.setDataAction(t.user_id,t.id,"1"),"data-toggle":"modal","data-target":"#aturTanggal"}," Accept ",8,ie)):h("",!0)])]))),128))])]),_:1})):h("",!0)])]),le])]),v(R)])]),e("div",re,[e("div",de,[e("div",ce,[ue,e("div",he,[e("form",{onSubmit:n[4]||(n[4]=T(t=>a.actionInvoice(a.dataAction.user_id,a.dataAction.invoice_id,a.dataAction.status_invoice,a.dataAction.tanggal_berakhir),["prevent"]))},[e("div",ge,[pe,C(e("input",{type:"date",class:"form-control",id:"tanggal","onUpdate:modelValue":n[3]||(n[3]=t=>a.dataAction.tanggal_berakhir=t)},null,512),[[D,a.dataAction.tanggal_berakhir]])]),_e],32)])])])],512),e("div",ve,[e("div",be,[e("div",me,[ke,e("div",fe,[e("img",{src:"https://backend-webmember.lumirainternational.com/storage/"+a.path,alt:"Bukti Transfer",style:{width:"100%"}},null,8,ye),we])])])],512)],64))}}),Te=y(Ae,[["__scopeId","data-v-2ef38b05"]]);export{Te as default};
