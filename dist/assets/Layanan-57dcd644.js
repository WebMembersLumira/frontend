import{N as p}from"./Navbar-0577d09a.js";import{_,j as d,o as m,c as k,d as a,f as i,b as l,G as b,y as w,z as y}from"./index-d4f638b3.js";import{C as f}from"./ChatMe-ce29fbf2.js";const h=e=>(w("data-v-7a4d674a"),e=e(),y(),e),v={id:"wrapper",oncontextmenu:"return false",onkeydown:"return false;",onmousedown:"return false;"},x={id:"content-wrapper",class:"d-flex flex-column"},A={id:"content"},S=h(()=>a("h1",{class:"h3 mb-0 text-gray-800 text-center mt-4"},"Layanan",-1)),T={class:"d-flex justify-content-center"},$=["data"],I=h(()=>a("p",null,"Browser tidak mendukung.",-1)),B=[I],L={data(){return{user_id:null,role:null,ready:null,link:"",active_token:"",myToken:""}},methods:{async checkMembership(){try{const e=await l.get(`https://backend-webmember.lumirainternational.com/api/auth/check-membership/${this.user_id}`,{headers:{Authorization:"Bearer "+sessionStorage.getItem("token")}});this.ready=!0,console.log("data:",e.data.status),e.data.status===401?this.showAlert("Anda belum berlangganan, silahkan berlangganan dulu"):new Date(e.data.data[0].tanggal_berakhir)<new Date?this.showAlert("Anda belum berlangganan, silahkan berlangganan terlebih dulu!!"):this.getLink()}catch(e){console.error(e)}},async getLink(){try{const e=await l.get("https://backend-webmember.lumirainternational.com/api/auth/get-link",{headers:{Authorization:"Bearer "+sessionStorage.getItem("token")}});console.log("link: ",e.data.data[0].link),this.link=e.data.data[0].link}catch(e){console.error(e)}},showAlert(e){this.$swal({title:"Layanan Tidak Tersedia",text:e,icon:"error"}).then(()=>{this.$router.push("user-invoice")})},async getActiveToken(){try{const e=await l.get(`https://backend-webmember.lumirainternational.com/api/auth/active-token/${this.user_id}`,{headers:{Authorization:"Bearer "+sessionStorage.getItem("token")}});this.active_token=e.data,this.myToken!==this.active_token&&this.showAlertAkun()}catch(e){console.error(e)}},showAlertAkun(){this.$swal({title:"Request Failed",text:"Akun anda sedang dibuka di perangkat lain!",icon:"error"}).then(()=>{sessionStorage.removeItem("token"),this.$router.push("/")})}},created(){const e=sessionStorage.getItem("token");if(this.myToken=e,e)try{const[t,o]=e.split("."),n=JSON.parse(atob(t)),r=atob(o),s=JSON.parse(atob(e.split(".")[1])),u=s.exp,c=new Date(u*1e3);console.log("Waktu Kedaluwarsa (UTC):",c.toUTCString()),new Date>c?(console.log("Keluar"),sessionStorage.removeItem("token"),this.$router.push("/")):console.log("Aman");const g=s.level;this.user_id=s.id,console.log("ini idddd:",this.user_id),g!=="0"?this.$router.push("/unauthorized"):(!n||!r)&&this.$router.push("/"),this.checkMembership(),this.getActiveToken()}catch(t){console.error("Error decoding token:",t),this.$router.push("/")}else this.$router.push("/")}},N=Object.assign(L,{__name:"Layanan",setup(e){const t=d(!1),o=d(""),n=()=>{t.value=!t.value,o.value=t.value?"toggle-sidebar":""};return(r,s)=>(m(),k("div",v,[a("div",x,[a("div",A,[i(p,{onToggleSidebar:n}),i(f),S,a("div",T,[a("object",{data:r.link,type:"text/html",width:"100%",height:"500px"},B,8,$)])]),i(b)])]))}}),j=_(N,[["__scopeId","data-v-7a4d674a"]]);export{j as default};
